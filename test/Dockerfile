FROM debian:stable

ARG RUBY_VERSION
ARG RUBY_PLATFORM
ARG EXPECTED_RUBY_ARCH
ARG EXPECTED_RUBY_VERSION

ENV \
  RUBY_VERSION=${RUBY_VERSION} \
  RUBY_PLATFORM=${RUBY_PLATFORM} \
  PATH=/opt/xrubies/${RUBY_VERSION}-${RUBY_PLATFORM}/bin:$PATH \
  EXPECTED_RUBY_ARCH=${EXPECTED_RUBY_ARCH} \
  EXPECTED_RUBY_VERSION=${EXPECTED_RUBY_VERSION}

# Install ruby
ADD tmp/${RUBY_VERSION}-${RUBY_PLATFORM}.tar.gz /

# Info
RUN ruby -v 

# Tests
ADD test/ test/
RUN ruby test/tests.rb